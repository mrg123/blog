# php对接支付宝



## TRADE_TOTALFEE_NOT_MATCH 交易单号金额不匹配

我在本地测试的时候经常出现这样的错误代码：

错误代码: TRADE_TOTALFEE_NOT_MATCH

错误描述: 抱歉，该商品的交易金额与原先的不一致，请重新创建交易付款。

尽管是个小问题，困扰了我很久，一开始我以为是网站的代码问题或是SESSION,COOKIE等。最后发现是支付宝这边的判断，以及我测试本身的逻辑错误。

首先我网上数据和本地数据是一样的。然后网上交易提交到支付宝会产生一个订单号out_trade_no,这里订单号提交到支付宝会记录下来.如果重复提交,则支付宝会认为是同一个订单.

我本地测试提交一个out_trade_no=200,网上已经提交过了out_trade_no=200,支付宝认为这是一样的订单,价格不一样就出现了错误代码: TRADE_TOTALFEE_NOT_MATCH

因此如果需要规避这样的错误,可以本地用一个新订单号,于网上完全不一样的.这样就不会重复了.

